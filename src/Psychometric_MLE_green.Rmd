---
title: "Model selection LRT green"
author: "Olsson et al."
date: "07/11/2020"
output: html_document
self_contained: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading packages required to run the analysis and the plotting.

```{r}
library('lattice')
library('graphics')
library('psyphy')
library('MASS')
library('glm2')
library('readr')
```

## Reading in the data

The script is constructed such that you should have one column with the number of correct choices ("corr" in the current version), second column with the number of incorrect choices("incorr" in the current version), and a third column representing the stimulus levels ("lint" in the current version; could be intensity, or whatever). Additional variables can be added.

```{r}
green.df <- read_delim('green_colours.txt', delim = "\t") 
green.df$background <- factor(green.df$background)
green.df$ind <- factor(green.df$ind)
green.df$batch <- as.factor(green.df$batch)
```

## Model testing, full and removing one factor at a time, simulating stepAIC

### setting up models

Null model, data is explained only by variance. lambda.init is your estimate of the upper asymptote and NumAlt specifies the number of alternatives e.g. 2 alternative forced choice.


Green colour

#### Model testing, null model and full model, and models removing one factor
```{r}
green.green.mod.0 <- glm.WH(cbind(corr,incorr)~1, data = green.df, lambda.init = 0.1, interval = c(0, 1), NumAlt = 2) # Null model, data is explained only by variance. lambda.init is your estimate of the upper asymptote and NumAlt specifies the number of alternatives e.g. 2 alternative forced choice
```

full model with 3-way interaction
```{r}
green.mod.1 <- glm.WH(cbind(corr,incorr)~Colour.difference*background*sex+ind+batch, data  = green.df, lambda.init = 0.05, interval = c(0, 1), NumAlt = 2, maxit=1000) # Model where data is affected by the stimulus level
anova(green.mod.0,green.mod.1,test="Chisq")
```

removing 3-way interaction
```{r}
green.mod.2 <- glm.WH(cbind(corr,incorr)~Colour.difference*background+Colour.difference*sex+background*sex+ind+batch, data  = green.df, lambda.init = 0.05, interval = c(0, 1), NumAlt = 2, maxit=100) # Model where data is affected by the stimulus level
anova(green.mod.1,green.mod.2,test="Chisq")
```

removing interaction colour difference:sex
```{r}
green.mod.21 <- glm.WH(cbind(corr,incorr)~Colour.difference*background+background*sex+ind+batch, data  = green.df, lambda.init = 0.01, interval = c(0, 1), NumAlt = 2, maxit=100) # Model where data is affected by the stimulus level
anova(green.mod.1,green.mod.2,test="Chisq")
```

removing interaction background:sex
```{r}
green.mod.22 <- glm.WH(cbind(corr,incorr)~Colour.difference*background+Colour.difference*sex+ind+batch, data  = green.df, lambda.init = 0.05, interval = c(0, 1), NumAlt = 2, maxit=100) # Model where data is affected by the stimulus level
anova(green.mod.2,green.mod.22,test="Chisq")
```

removing interaction colour difference:background
```{r}
green.mod.23 <- glm.WH(cbind(corr,incorr)~Colour.difference+background+Colour.difference*sex+background*sex+ind+batch, data  = green.df, lambda.init = 0.05, interval = c(0, 1), NumAlt = 2, maxit=100) # Model where data is affected by the stimulus level
anova(green.mod.2,green.mod.23,test="Chisq")
```

 removing all interaction
```{r}
green.mod.24 <- glm.WH(cbind(corr,incorr)~Colour.difference+background+sex+ind+batch, data  = green.df, lambda.init = 0.05, interval = c(0, 1), NumAlt = 2, maxit=1000) # Model where data is affected by the stimulus level
anova(green.mod.2,green.mod.24,test="Chisq")
```

Compare all models
```{r}
AIC(green.mod.0,green.mod.2,green.mod.22,green.mod.23,green.mod.24)
```

#Check "random" effects

removing batch
```{r}
green.mod.3 <- glm.WH(cbind(corr,incorr)~Colour.difference+background+sex+ind, data  = green.df, lambda.init = 0.05, interval = c(0, 1), NumAlt = 2, maxit=100) # Model where data is affected by the stimulus level
```

removing individual identity
```{r}
green.mod.31 <- glm.WH(cbind(corr,incorr)~Colour.difference+background+sex+batch, data  = green.df, lambda.init = 0.05, interval = c(0, 1), NumAlt = 2, maxit=100) # Model where data is affected by the stimulus level
```

removing sex
```{r}
green.mod.32 <- glm.WH(cbind(corr,incorr)~Colour.difference+background+batch, data  = green.df, lambda.init = 0.05, interval = c(0, 1), NumAlt = 2, maxit=100) # Model where data is affected by the stimulus level
```

removing background
```{r}
green.mod.33<- glm.WH(cbind(corr,incorr)~Colour.difference+sex+ind+batch, data  = green.df, lambda.init = 0.05, interval = c(0, 1), NumAlt = 2, maxit=1000) # Model where data is affected by the stimulus level
```

removing colour difference
```{r}
green.mod.34 <- glm.WH(cbind(corr,incorr)~background+sex+ind+batch, data  = green.df, lambda.init = 0.05, interval = c(0, 1), NumAlt = 2, maxit=1000) # Model where data is affected by the stimulus level
```

Compare all
```{r}
anova(green.mod.24,green.mod.3,test="Chisq")
anova(green.mod.24,green.mod.31,test="Chisq")
anova(green.mod.24,green.mod.32,test="Chisq")
anova(green.mod.24,green.mod.33,test="Chisq")
anova(green.mod.24,green.mod.34,test="Chisq")

AIC(green.mod.24,green.mod.3,green.mod.31,green.mod.32,green.mod.33,green.mod.34)
```


removing batch and ind
```{r}
green.mod.5 <- glm.WH(cbind(corr,incorr)~Colour.difference*background*sex, data  = green.df, lambda.init = 0.1, interval = c(0, 1), NumAlt = 2, maxit=100) # Model where data is affected by the stimulus level
anova(green.mod.1,green.mod.3,test="Chisq")
anova(green.mod.1,green.mod.4,test="Chisq")
anova(green.mod.1,green.mod.5,test="Chisq")


AIC(green.mod.0, green.mod.1, green.mod.2, green.mod.3, green.mod.4, green.mod.5)
```

Compare models 1 & 2
```{r}
anova(green.mod.1, green.mod.2, test= "Chisq")
```

Compare models 1 & 3
```{r}
anova(green.mod.1, green.mod.3, test= "Chisq")
```

Compare models 1 & 4
```{r}
anova(green.mod.1, green.mod.4, test= "Chisq")
```

Compare models 1 & 5
```{r}
anova(green.mod.1, green.mod.5, test="Chisq")
```

Compare all
```{r}
anova(green.mod.1,green.mod.2,green.mod.3,green.mod.4,green.mod.5, test="Chisq")
```

#Check details of model 1
```{r}
anova(green.mod.1)
summary(green.mod.1)
```